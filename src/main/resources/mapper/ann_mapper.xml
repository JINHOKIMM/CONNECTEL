<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.connec.tel.dao.AnnDAO">
<select id="list" resultType="annDTO" parameterType="map">
    SELECT ann_no, ann_subject, ann_content, ann_bHit, ann_division, ann_fixed, register, ann_date
    FROM announcement
    WHERE ann_division = 'E'
    ORDER BY ann_fixed DESC, ann_no DESC -- ann_fixed를 우선순위로 내림차순 정렬, 그 다음 ann_no 내림차순 정렬
    LIMIT #{pagePerCnt} OFFSET ${(currPage - 1) * pagePerCnt}
</select>

<select id="allCount" resultType="Integer">
    SELECT CEIL(COUNT(ann_no) / #{param1}) AS pages FROM announcement WHERE ann_division = 'E'
</select>
	
    <delete id="deleteann" parameterType="list">
        DELETE FROM announcement WHERE ann_no IN 
        <foreach item="ann_no" collection="list" open="(" separator="," close=")">
            #{ann_no}
        </foreach>
    </delete>	
	
	<insert id="write" useGeneratedKeys="true" keyColumn="ann_no" keyProperty="ann_no" parameterType="annDTO">
    	INSERT INTO announcement (ann_subject, register, ann_content, ann_division, ann_date)
    	VALUES (#{ann_subject}, #{register}, #{ann_content}, #{ann_division}, NOW())
	</insert>
	
	<insert id="fileWrite">
		INSERT INTO photo(ori_pho_name,pho_name, ref_idx, pho_division)
		VALUES(#{param1},#{param2},#{param3},'A')	
	</insert>
	
	<select id="search" parameterType="string" resultType="annDTO">
    	SELECT * FROM announcement
    	WHERE ann_subject LIKE CONCAT('%', #{textval}, '%')
    	ORDER BY ann_no DESC
	</select>

	<select id="photo" parameterType="string" resultType="string">
    SELECT pho_name
    FROM photo 
    WHERE ann_no = #{ann_no} AND pho_division = 'A'
</select>
	
	
</mapper>